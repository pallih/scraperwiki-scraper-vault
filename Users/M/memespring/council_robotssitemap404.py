import scraperwiki
import urllib2

def looks_like_404(response):

    result = False
    if response.title.find('404') or response.title.lower().find('not found') or response.title.lower().find('error'):
        result = True

    return result

#note: excludes the following because of weird errors: 'http://www.dumgal.gov.uk',
sites = ['http://www.aberdeencity.gov.uk/','http://www.aberdeenshire.gov.uk/','http://www.adur.gov.uk/','http://www.allerdale.gov.uk/','http://www.ambervalley.gov.uk','http://www.angus.gov.uk','http://www.antrim.gov.uk/','http://www.ards-council.gov.uk/','http://www.argyll-bute.gov.uk','http://www.armagh.gov.uk','http://www.arun.gov.uk/','http://www.ashfield-dc.gov.uk/','http://www.ashford.gov.uk/','http://www.aylesburyvaledc.gov.uk/','http://www.babergh.gov.uk/','http://www.ballymena.gov.uk/','http://www.ballymoney.gov.uk/','http://www.banbridge.com/','http://www.barking-dagenham.gov.uk','http://www.barnet.gov.uk/','http://www.barnsley.gov.uk','http://www.barrowbc.gov.uk/','http://www.basildon.gov.uk','http://www.basingstoke.gov.uk','http://www.bassetlaw.gov.uk/','http://www.bathnes.gov.uk','http://www.bedford.gov.uk/','http://www.belfastcity.gov.uk','http://www.bexley.gov.uk','http://www.birmingham.gov.uk','http://www.blaby.gov.uk','http://www.blackburn.gov.uk/','http://www.blackpool.gov.uk/','http://www.blaenau-gwent.gov.uk/','http://www.bolsover.gov.uk','http://www.bolton.gov.uk','http://www.boston.gov.uk','http://www.bournemouth.gov.uk','http://www.bracknell-forest.gov.uk','http://www.bradford.gov.uk','http://www.braintree.gov.uk','http://www.breckland.gov.uk/','http://www.brent.gov.uk','http://www.brentwood-council.gov.uk','http://www.bridgend.gov.uk','http://www.brighton-hove.gov.uk','http://www.bristol.gov.uk','http://www.broadland.gov.uk','http://www.bromley.gov.uk','http://www.bromsgrove.gov.uk','http://www.broxbourne.gov.uk/','http://www.broxtowe.gov.uk/','http://www.buckscc.gov.uk/','http://www.burnley.gov.uk/','http://www.bury.gov.uk','http://www.caerphilly.gov.uk','http://www.calderdale.gov.uk','http://www.cambridge.gov.uk','http://www.cambridgeshire.gov.uk/','http://www.camden.gov.uk','http://www.cannockchasedc.gov.uk/','http://www.canterbury.gov.uk','http://www.cardiff.gov.uk','http://www.carlisle.gov.uk','http://www.carmarthenshire.gov.uk','http://www.carrickfergus.org','http://www.castlepoint.gov.uk','http://www.castlereagh.gov.uk','http://www.centralbedfordshire.gov.uk/','http://www.ceredigion.gov.uk','http://www.charnwood.gov.uk','http://www.chelmsford.gov.uk','http://www.cheltenham.gov.uk','http://www.cherwell.gov.uk','http://www.cheshireeast.gov.uk','http://www.cheshirewestandchester.gov.uk','http://www.chesterfield.gov.uk','http://www.chichester.gov.uk','http://www.chiltern.gov.uk','http://www.chorley.gov.uk','http://www.dorsetforyou.com/Christchurch','http://www.clacksweb.org.uk','http://www.colchester.gov.uk','http://www.colerainebc.gov.uk/','http://www.conwy.gov.uk/','http://www.cookstown.gov.uk/','http://www.copelandbc.gov.uk/','http://www.corby.gov.uk','http://www.cornwall.gov.uk','http://www.cotswold.gov.uk','http://www.coventry.gov.uk','http://www.craigavon.gov.uk','http://www.cravendc.gov.uk','http://www.crawley.gov.uk','http://www.croydon.gov.uk','http://www.cumbriacc.gov.uk','http://www.dacorum.gov.uk','http://www.darlington.gov.uk','http://www.dartford.gov.uk','http://www.daventrydc.gov.uk','http://www.denbighshire.gov.uk','http://www.derby.gov.uk','http://www.derbyshire.gov.uk','http://www.derbyshiredales.gov.uk','http://www.derrycity.gov.uk','http://www.devon.gov.uk','http://www.doncaster.gov.uk','http://www.dorsetforyou.com/county','http://www.dover.gov.uk','http://www.downdc.gov.uk','http://www.dudley.gov.uk','http://www.dundeecity.gov.uk','http://www.dungannon.gov.uk/','http://www.durham.gov.uk','http://www.ealing.gov.uk','http://www.east-ayrshire.gov.uk','http://www.eastcambs.gov.uk','http://www.eastdevon.gov.uk','http://www.dorsetforyou.com/east','http://www.eastdunbarton.gov.uk','http://www.easthants.gov.uk','http://www.eastherts.gov.uk','http://www.e-lindsey.gov.uk','http://www.eastlothian.gov.uk','http://www.east-northamptonshire.gov.uk','http://www.eastrenfrewshire.gov.uk','http://www.eastriding.gov.uk','http://www.eaststaffsbc.gov.uk/','http://www.eastsussex.gov.uk','http://www.eastbourne.gov.uk','http://www.eastleigh.gov.uk','http://www.eden.gov.uk/','http://www.edinburgh.gov.uk','http://www.elmbridge.gov.uk','http://www.enfield.gov.uk/','http://www.eppingforestdc.gov.uk','http://www.epsom-ewell.gov.uk','http://www.erewash.gov.uk','http://www.essexcc.gov.uk','http://www.exeter.gov.uk','http://www.falkirk.gov.uk','http://www.fareham.gov.uk','http://www.fenland.gov.uk','http://www.fermanagh.gov.uk','http://www.fifedirect.org.uk','http://www.flintshire.gov.uk','http://www.forest-heath.gov.uk/','http://www.fdean.gov.uk','http://www.fylde.gov.uk','http://www.gateshead.gov.uk/','http://www.gedling.gov.uk','http://www.glasgow.gov.uk','http://www.gloucester.gov.uk','http://www.gloucestershire.gov.uk','http://www.gosport.gov.uk','http://www.gravesham.gov.uk','http://www.great-yarmouth.gov.uk','http://www.royalgreenwich.gov.uk','http://www.guildford.gov.uk','http://www.gwynedd.gov.uk','http://www.hackney.gov.uk/','http://www.halton.gov.uk/','http://www.hambleton.gov.uk/','http://www.lbhf.gov.uk/','http://www.hants.gov.uk','http://www.harborough.gov.uk','http://www.haringey.gov.uk/','http://www.harlow.gov.uk','http://www.harrogate.gov.uk/','http://www.harrow.gov.uk','http://www.hart.gov.uk','http://www.hartlepool.gov.uk/','http://www.hastings.gov.uk','http://www.havant.gov.uk','http://www.havering.gov.uk','http://www.herefordshire.gov.uk','http://www.hertsdirect.org/','http://www.hertsmere.gov.uk/','http://www.highpeak.gov.uk','http://www.highland.gov.uk','http://www.hillingdon.gov.uk/','http://www.hinckleyandbosworthonline.org.uk','http://www.horsham.gov.uk/','http://www.hounslow.gov.uk','http://www.huntsdc.gov.uk','http://www.hyndburnbc.gov.uk','http://www.inverclyde.gov.uk','http://www.ipswich.gov.uk','http://www.anglesey.gov.uk','http://www.scilly.gov.uk','http://www.iwight.com','http://www.islington.gov.uk/','http://www.rbkc.gov.uk/','http://www.kent.gov.uk','http://www.kettering.gov.uk','http://www.west-norfolk.gov.uk','http://www.hullcc.gov.uk','http://www.kingston.gov.uk/','http://www.kirklees.gov.uk/','http://www.knowsley.gov.uk/','http://www.lambeth.gov.uk','http://www.lancashire.gov.uk/','http://www.lancaster.gov.uk','http://www.larne.gov.uk/','http://www.leeds.gov.uk','http://www.leicester.gov.uk','http://www.leicestershire.gov.uk/','http://www.lewes.gov.uk','http://www.lewisham.gov.uk/','http://www.lichfielddc.gov.uk','http://www.limavady.gov.uk','http://www.lincoln.gov.uk','http://www.lincolnshire.gov.uk/','http://www.lisburncity.gov.uk','http://www.liverpool.gov.uk','http://www.cityoflondon.gov.uk/Corporation','http://www.london.gov.uk','http://www.luton.gov.uk','http://www.magherafelt.gov.uk','http://www.maidstone.gov.uk/','http://www.maldon.gov.uk','http://malvern.whub.org.uk','http://www.manchester.gov.uk','http://www.mansfield.gov.uk','http://www.medway.gov.uk','http://www.melton.gov.uk','http://www.mendip.gov.uk','http://www.merthyr.gov.uk','http://www.merton.gov.uk/','http://www.middevon.gov.uk','http://www.midsuffolk.gov.uk','http://www.midsussex.gov.uk','http://www.middlesbrough.gov.uk','http://www.midlothian.gov.uk','http://www.miltonkeynes.gov.uk','http://www.mole-valley.gov.uk/','http://www.monmouthshire.gov.uk','http://www.moray.gov.uk','http://www.moyle-council.org','http://www.neath-porttalbot.gov.uk','http://www.nfdc.gov.uk','http://www.newark-sherwooddc.gov.uk','http://www.newcastle-staffs.gov.uk','http://www.newcastle.gov.uk','http://www.newham.gov.uk','http://www.newport.gov.uk','http://www.newryandmournedc.gov.uk','http://www.newtownabbey.gov.uk','http://www.norfolk.gov.uk/','http://www.north-ayrshire.gov.uk','http://www.northdevon.gov.uk','http://www.dorsetforyou.com/northdorset','http://www.northdown.gov.uk','http://www.ne-derbyshire.gov.uk','http://www.nelincs.gov.uk','http://www.north-herts.gov.uk','http://www.n-kesteven.gov.uk','http://www.northlanarkshire.gov.uk/','http://www.northlincs.gov.uk','http://www.northnorfolk.org/','http://www.n-somerset.gov.uk','http://www.northtyneside.gov.uk/','http://www.northwarks.gov.uk','http://www.nwleics.gov.uk','http://www.northyorks.gov.uk','http://www.northampton.gov.uk','http://www.northamptonshire.gov.uk','http://www.northumberland.gov.uk','http://www.norwich.gov.uk','http://www.nottinghamcity.gov.uk','http://www.nottinghamshire.gov.uk','http://www.nuneatonandbedworth.gov.uk','http://www.oadby-wigston.gov.uk','http://www.oldham.gov.uk/','http://www.omagh.gov.uk','http://www.orkney.gov.uk','http://www.oxford.gov.uk','http://www.oxfordshire.gov.uk/','http://www.pembrokeshire.gov.uk','http://www.pendle.gov.uk/','http://www.pkc.gov.uk','http://www.peterborough.gov.uk','http://www.plymouth.gov.uk','http://www.boroughofpoole.com','http://www.portsmouth.gov.uk','http://www.powys.gov.uk','http://www.preston.gov.uk','http://www.dorsetforyou.com/purbeck','http://www.reading.gov.uk/','http://www.redbridge.gov.uk/','http://www.redcar-cleveland.gov.uk/','http://www.redditchbc.gov.uk','http://www.reigate-banstead.gov.uk/','http://www.renfrewshire.gov.uk','http://www.rhondda-cynon-taf.gov.uk','http://www.ribblevalley.gov.uk','http://www.richmond.gov.uk/','http://www.richmondshire.gov.uk','http://www.rochdale.gov.uk','http://www.rochford.gov.uk','http://www.rossendale.gov.uk/','http://www.rother.gov.uk','http://www.rotherham.gov.uk','http://www.rugby.gov.uk','http://www.runnymede.gov.uk','http://www.rushcliffe.gov.uk','http://www.rushmoor.gov.uk','http://www.rutland.gov.uk','http://www.ryedale.gov.uk','http://www.salford.gov.uk','http://www.sandwell.gov.uk','http://www.scarborough.gov.uk','http://www.scotborders.gov.uk','http://www.sedgemoor.gov.uk','http://www.sefton.gov.uk','http://www.selby.gov.uk','http://www.sevenoaks.gov.uk','http://www.sheffield.gov.uk','http://www.shepway.gov.uk','http://www.shetland.gov.uk','http://www.shropshire.gov.uk','http://www.slough.gov.uk','http://www.solihull.gov.uk','http://www.somerset.gov.uk','http://www.south-ayrshire.gov.uk','http://www.southbucks.gov.uk','http://www.scambs.gov.uk','http://www.south-derbys.gov.uk','http://www.southglos.gov.uk','http://www.southhams.gov.uk','http://www.sholland.gov.uk','http://www.southkesteven.gov.uk','http://www.southlakeland.gov.uk','http://www.southlanarkshire.gov.uk','http://www.south-norfolk.gov.uk','http://www.southnorthants.gov.uk','http://www.southoxon.gov.uk','http://www.southribble.gov.uk/','http://www.southsomerset.gov.uk','http://www.sstaffs.gov.uk','http://www.southtyneside.info/','http://www.southampton.gov.uk','http://www.southend.gov.uk','http://www.southwark.gov.uk','http://www.spelthorne.gov.uk','http://www.stalbans.gov.uk','http://www.stedmundsbury.gov.uk','http://www.sthelens.gov.uk/','http://www.staffordbc.gov.uk','http://www.staffordshire.gov.uk','http://www.staffsmoorlands.gov.uk','http://www.stevenage.gov.uk','http://www.stirling.gov.uk','http://www.stockport.gov.uk','http://www.stockton.gov.uk','http://www.stoke.gov.uk','http://www.strabanedc.org.uk','http://www.stratford.gov.uk','http://www.stroud.gov.uk','http://www.suffolkcoastal.gov.uk','http://www.suffolk.gov.uk','http://www.sunderland.gov.uk','http://www.surreycc.gov.uk','http://www.surreyheath.gov.uk','http://www.sutton.gov.uk','http://www.swale.gov.uk','http://www.swansea.gov.uk','http://www.swindon.gov.uk','http://www.tameside.gov.uk','http://www.tamworth.gov.uk','http://www.tandridge.gov.uk','http://www.tauntondeane.gov.uk','http://www.teignbridge.gov.uk','http://www.telford.gov.uk','http://www.tendringdc.gov.uk','http://www.testvalley.gov.uk','http://www.tewkesburybc.gov.uk','http://www.thanet.gov.uk','http://www.threerivers.gov.uk/','http://www.thurrock.gov.uk','http://www.tmbc.gov.uk','http://www.torbay.gov.uk','http://www.torfaen.gov.uk','http://www.torridge.gov.uk','http://www.towerhamlets.gov.uk','http://www.trafford.gov.uk','http://www.tunbridgewells.gov.uk','http://www.uttlesford.gov.uk','http://www.valeofglamorgan.gov.uk','http://www.whitehorsedc.gov.uk','http://www.wakefield.gov.uk','http://www.walsall.gov.uk/','http://www.walthamforest.gov.uk/','http://www.wandsworth.gov.uk/','http://www.warrington.gov.uk/','http://www.warwickdc.gov.uk','http://www.warwickshire.gov.uk/','http://www.watford.gov.uk/','http://www.waveney.gov.uk','http://www.waverley.gov.uk/','http://www.wealden.gov.uk','http://www.wellingborough.gov.uk/','http://www.welhat.gov.uk','http://www.westberks.gov.uk','http://www.westdevon.gov.uk','http://www.dorsetforyou.com/west','http://www.west-dunbarton.gov.uk/','http://www.westlancsdc.gov.uk/','http://www.west-lindsey.gov.uk/','http://www.westlothian.gov.uk/','http://www.westoxon.gov.uk/','http://www.westsomersetonline.gov.uk','http://www.westsussex.gov.uk/','http://www.cne-siar.gov.uk','http://www.westminster.gov.uk/','http://www.dorsetforyou.com/weymouthandportland','http://www.wiganmbc.gov.uk/','http://www.wiltshire.gov.uk','http://www.winchester.gov.uk','http://www.rbwm.gov.uk/','http://www.wirral.gov.uk/','http://www.woking.gov.uk/','http://www.wokingham.gov.uk','http://www.wolverhampton.gov.uk','http://www.worcester.gov.uk','http://www.worcestershire.gov.uk/','http://www.worthing.gov.uk/','http://www.wrexham.gov.uk/','http://wychavon.whub.org.uk','http://www.wycombe.gov.uk','http://www.wyrebc.gov.uk/','http://www.wyreforestdc.gov.uk','http://www.york.gov.uk',]



for site in sites:
    has_sitemap = False
    has_robots = False
    has_404 = 'present'

    #quick hack for http://www.dorsetforyou.com/ which contains subsites
    if site.find('http://www.dorsetforyou.com/') > -1:
        site = 'http://www.dorsetforyou.com'


    #test 404
    try:
        response = urllib2.urlopen('%s/bprgsylrkwtjscefh3h448hknm56bfa94626x731' % site)
        print response.code
        if response.code == 200:
            has_404 = 'fake'
            print "fake 404"
    except urllib2.HTTPError, e:
        if e.code == 404:
            has_404 = 'present'
        else:
            has_404 = 'errors'
    except urllib2.URLError, e:
            has_404 = 'errors'

    #test robots.txt
    try:
        response = urllib2.urlopen('%s/robots.txt' % site)
        print response.code
        if response.code == 200:
            has_robots = 'present'
    except urllib2.HTTPError, e:
        if e.code == 404:
            has_robots = 'missing'
        else:
            has_robots = 'errors'
    except urllib2.URLError, e:
            has_robots = 'errors'


    #test sitemap.xml
    try:
        response = urllib2.urlopen('%s/sitemap.xml' % site)
        print response.code
        if response.code == 200:
            has_sitemap = 'present'
    except urllib2.HTTPError, e:
        if e.code == 404:
            has_sitemap = 'missing'
        else:
            has_sitemap = 'errors'
    except urllib2.URLError, e:
            has_sitemap = 'errors'


    #save
    data = {'url': site, 'has_404': has_404, 'has_robots': has_robots, 'has_sitemap': has_sitemap}
    scraperwiki.sqlite.save(unique_keys=['url'], data=data)        